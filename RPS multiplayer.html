<!DOCTYPE html>
<html>
  <head>
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
     <script src = "RPSmultiplayer.js"></script>
       <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
       <style type="text/css" src="RPSmultiplayer.CSS"></style>
     <style type="text/css">
       #main1, #main2{
         width: 450px; 
         height: 700px;
        background-color: #eeedef;
        padding: 10px 50px 50px 50px;
        border-radius: 20px;
        box-shadow: 10px 15px 5px #d0e8ed;
        margin: auto; 
        border: 2px solid #300835; 
       }*/
        
       #player1, #player2{
         background-color: #80d9ed;
       }
       #paper, #rock, #{
        text-align: center;
       }
       .clearfix:after{
        content: "";
        display: block;
        clear: both;
       }
       body{
        background-image: linear-gradient(rgba(62,20,20,0.4) rgba(62,20.20.0.4)), url(back.jpeg);
        background-size: cover; 
        background-position: center; 
        color: #555;
       }
       #begin{
        text-align: center;
       }
       #name{
        background-color: #e1e8e6; 
        margin: auto; 
        font-size: 30px;
        padding: 50px 50px 50px 50px;
        max-width: 85%;
       }
       #name2, #main2{
        float: right;
       }
       #name1, #name2{
        padding: 50px 10px;
        background-color: #e1e8e6; 
       }
       
     
       </style>
 </head>
 <body>
  <div class="col-lg-4" id ="name1">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Paper, Rock or Scissors?</h3>
            </div>
            <div class="panel-body">
              <h4>Enter your name to get started</h4>
            <div id ="tip"></div>
        <input type="text" placeholder="Choose your game name" required id="play1">
         <button type="button" class="btn btn-primary" id="enterName1">Submit</button>
            </div>
          </div>
        </div>

    <div class="col-lg-4" id ="name2">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Paper, Rock or Scissors?</h3>
            </div>
            <div class="panel-body" id="recent-member">
              <h4>Enter your name to get started</h4>
        <input type ="text"placeholder="Choose your game name" required id="play2">
         <button type="button" class="btn btn-primary" id="enterName2">Submit</button>
            </div>
          </div>
        </div>
 
    
    


  <div class="col-lg-6" id="main1">
  <h2>Paper, Rock or Scissors?</h2>
  <div>
    <div><p><strong>Game instructions<strong></p></div>

  
   <p>You're playing against an enemy. Select either Paper, Rock or scissors below. Your answer will be compared against the enemy and show you if you won or lost</p>

     <button type="button" class="btn btn-info" id ="begin">Flip a coin to get started</button>
   
   </div>
   <br>
    <div id="pick" style:"text-align: left;">
    <p>What's your Pick?</p>
    <div id="chances"></div>
    <button type="button" class="btn btn-primary pOne" data-name="paper">Paper</button>
    <button type="button" class="btn btn-primary pOne" data-name="rock">Rock </button>
    <button type="button" class="btn btn-primary pOne" data-name ="scissors">Scissors</button>
  </div>
  <br>
  <div class="wrapper">
    <div class="player-1-panel active" id ="first">
      <div class="panel-heading" id ="player1"></div>
     <!--  <div class="panel-body" id="playEr1guess"></div> -->
      <div class="player-current-box">
        <div class="player-current-label choice" id ="winloss1">Current</div>
        <div class = "player-current-score" id="score">Score</div>
      </div>
      <div >
        <input id="message">
        <h2 id ="enterChatmsg"></h2>
        <button class="btn btn-success" id = "chat">Chat</button>
      </div>
   

    </div>
  
    <hr>
    <div>
      <button type="button" class="bbtn btn-primary" id="try">Try Again</button>
    </div>
  </div>
 
</div>

<div class="col-lg-6" id="main2">
  <h2>Paper, Rock or Scissors?</h2>
  <div>
    <div><p><strong>Game instructions<strong></p></div>

  
   <p>You're playing against an enemy select either Paper, Rock or scissors below. Your answer will be compared against the enemy and show you if you won or lost</p>

     <button type="button" class="btn btn-info" id ="begin">Flip a coin to get started</button>
   
   </div>
   <br>
    <div id="pick" style:"text-align: left;">
    <p>What's your Pick?</p>
    <div id="chances2"></div>
    <button type="button" class="btn btn-primary ptwo" data-name="paper2">Paper</button>
    <button type="button" class="btn btn-primary ptwo" data-name="rock2">Rock </button>
    <button type="button" class="btn btn-primary ptwo" data-name ="scissors2">Scissors</button>
  </div>
  <br>
  <div class="wrapper">
    <div class="player-2-panel active" id = "second">
      <div class="panel-heading" id ="player2"></div>
      <!-- <div class="panel-body" id="player2Guess"></div> -->
      <div class="player-current-box">
        <div class="player-current-label" id ="winloss2">Current</div>
        <div class = "player-current-score" id="score2">Score</div>
      </div>
      <div >
        <input id="message2">
        <h2 id ="enterChatmsg2"></h2>
        <button class="btn btn-success" id = "chat2">Chat</button>
      </div>

    </div>

    <hr>
    <div>
      <button type="button" class="btn btn-primary" id="try">Try Again</button>
    </div>
  </div>
 
</div>

   <!-- Script -->
  <script>
  $( document ).ready(function() {
   
    // ========================================== START CODING BELOW!!

    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyAAiXkgze7_0fmtSvgoNS9nIDeQiXfkhrM",
    authDomain: "rps-multiplayer-d713e.firebaseapp.com",
    databaseURL: "https://rps-multiplayer-d713e.firebaseio.com",
    projectId: "rps-multiplayer-d713e",
    storageBucket: "",
    messagingSenderId: "601659965604"
    };

    firebase.initializeApp(config);

    // Create a variable to reference the database.
    var database = firebase.database();

    var connectedRef = firebase.database().ref(".info/connected");
  connectedRef.on("value", function(snap) {
  if (snap.val() === true) {
    console.log("connected");
  } else {
    console.log("not connected");
  }
});
    // Initial Values
    
    
    var roundScore =0;
    var player1 =$("#play1").val();
    var player2 = $("#play2").val();
    var onePlaymsg = [];
    var twoPlaymsg = [];
    var Player2Guessed = "";
    var Player1Guessed = "";
    var Player1wins = 0; 
    var Player2wins = 0; 
    var Player1losses = 0;
    var Player2losses = 0;
    var scoreOne =0; 
    var scoreTwo = 0; 
    var startGame;
    var chances =5;
    var wins =0;
    var losses = 0; 

    
    //user makes a choice '
    //computer makes a choice 
    //do comparison'

    var userChoice = "";
    
    // var computerPick = Math.random();

    $("#main1").hide();
    $("#main2").hide();
    $("#tip").hide();
//pick game name 
   $("#enterName1").on("click", function(){
    event.preventDefault();
    player1 = $("#play1").val();
    console.log(player1)
    if(player1===""){
       $("#tip").html("Please enter a nickname");
    }else if(!(player1 === "")) && (!(player2 === "")){
      database.ref().update({
      player1: player1
       $("#name1").hide();
   $("#main1").show();
    }else{
      $("#first").text("Waiting on the enemy")

    }
   
   
  };


   }); 
  $("#enterName2").on("click", function(){
    event.preventDefault();
    player2 = $("#play2").val();
   console.log(player2);
    if(player2 === ""){
      $("#tip").text("please pick a nickname")
    }else if(!(player2 === "")) && (!(player1 === "")){
      database.ref().update({
      player2: player2
       $("#name2").hide();
      $("#main2").show();
    }else{
      $("#second").text("Waiting on the enemy")

    }
   
   
  };


   }); 

  //make a selection 

  $(".ptwo").on("click", function(){
    var Player2Guessed = $(this).attr("data-name");
    console.log(Player2Guessed);
   chances--; 
      database.ref().update({
      Player2Guessed: Player2Guessed
  });
  });



$(".pOne").on("click", function(){
  var Player1Guessed =$(this).attr("data-name");
  console.log(Player1Guessed);
  chances--;
  database.ref().update({
      Player1Guessed: Player1Guessed
  });
 

//});
//compare comparisons 

            if ((Player1Guessed == 'rock') && (Player2Guessed == 'scissors')){
                Player1wins++;
                scoreOne++
                Player2losses++;
                database.ref().update({
                  wins: Player1wins
                }); 
                  database.ref().update({
                  losses: Player2losses
                }); 

                 
                $('#winloss1').append(snapshot.child('player1').val().toUpperCase() + " WINS!!!");
                
                
                
            }else if ((Player1Guessed == 'rock') && (Player2Guessed == 'paper')){
                 Player2wins++;
                 scoreTwo++;
                Player1losses++;
                database.ref().update({
                  losses: Player1losses
               
                }); 
                database.ref().update({
                 
                  wins: Player2wins
                }); 

               
                $('#winloss2').append(snapshot.child('players2').val().toUpperCase() + " WINS!!!");

            }else if ((Player1Guessed == 'scissors') && (Player2Guessed == 'rock')){
                Player2wins++;
                scoreTwo;
                Player1losses++;
                database.ref().update({
                  losses: Player1losses
                }); 
                database.ref().update({
                  wins: Player2wins
                });
                
                $('#winloss2').append(snapshot.child('players2').val().toUpperCase() + " WINS!!!");

            }else if ((Player1Guessed === 'scissors') && (Player2Guessed === 'paper')){
                Player1wins++;
                scoreOne++;
                Player2losses++;
                database.ref().update({
                  wins: Player1wins
                }); 
                database.ref().update({
                  losses: Player2losses
                }); 
                
                $('#winloss1').append(snapshot.child('player1').val().toUpperCase() + " WINS!!!");

            }else if ((Player1Guessed === 'paper') && (Player2Guessed === 'rock')){
                Player1wins++;
                scoreOne++;
                Player2losses++;
                database.ref().update({
                  wins: Player1wins
                }); 
                database.ref().update({
                  wins: Player2losses
                }); 
                
                $('#winloss1').append(snapshot.child('player1').val().toUpperCase() + " WINS!!!");

            }else if ((Player1Guessed === 'paper') && (Player2Guessed === 'scissors')){
                Player1losses++;
                Player2wins++;
                scoreTwo++; 
                database.ref().update({
                  losses: Player1losses
                }); 
                database.ref().update({
                  wins: Player2wins
                }); 
                
                $('#winloss2').append(snapshot.child('player2').val().toUpperCase() + " WINS!!!");
              };
           
       });
//winner
if(chances === 0){
  if(scoreOne > scoreTwo){
  roundScore = $("#score1").text("You WON by  " + snapshot.child('scoreOne').val());
}else{
  $("#score1").text("You LOST");
}
};

if(chances === 0){
  if(scoreTwo > scoreOne){
  roundScore = $("#score2").text("You WON by  " + snapshot.child('scoreTwo').val());
}else{
  $("#score1").text("You LOST");
}
};





  //send message
  $("#chat").on("click", function(){
    onePlaymsg;
    onePlaymsg.push($("#message").val();) 
    for(var i =0; i<onePlaymsg.length, i++){

      if(onePlaymsg === ""){
      var enterChat = $("#enterChatmsg").text("Please enter a message");
    }else{
      $("#enterChatmsg").hide();
      $("#enterChatmsg2").text("You have a message from the enemy: " + onePlaymsg);
      database.ref().update({
        onePlaymsg: onePlaymsg
  });

    };
    }; 
});
  $("#chat2").on("click", function(){
    twoPlaymsg;
    twoPlaymsg.push($("#message2").val());
    for (var i =0; twoPlaymsg.length; i++){
        if(twoPlaymsg ===""){
        var enterChat = $("#enterChatmsg2").text("Please enter a message");
      }else{
        $("#enterChatmsg2").hide();
        $("#enterChatmsg").text("You have a message from the enemy: " + twoPlaymsg);
        database.ref().update({
          twoPlaymsg: twoPlaymsg
        
  });

    }
    }
    
    
});
    function init(){
      var roundScore =0;
    $("#main").hide();
    $("#tip").hide();
    var startGame;
    var chances =5;

    }
    


      $("#begin").on("click", function(){

    var r = Math.floor((Math.random() * 2) + 1);
    startGame=0;
    if(r===1){
        turn = player1;
        $("#begin").text(player1+"'s turn now!");
        $("#player1").text( "Your Turn");
    }
    else{
        turn = player2;
        $("#begin").text(player2+"'s turn now!");
        $("#player2").text( "Your Turn");
    }

   });
  
   
    

  
      if(!(chances===0)){
        roundScore+=chances;
        
      }else{
        //activePlayer === 0 ? activePlayer =1 : activePlayer =0;
        if( activePlayer === 0){
          activePlayer =1;
        }else{
          activePlayer =2;
        }
        roundScore =0;
        $(".player-1-panel").toggleclass("active");
         $(".player-2-panel").toggleclass("active")

    }
    
      


      // Code for handling the push
      database.ref().push({
        onePlaymsg: onePlaymsg,
        twoPlaymsg: twoPlaymsg,
        Player1Guessed : Player1Guessed,
        Player2Guessed: Player2Guessed,
        Player1losses: Player1losses,
        Player2losses: Player2losses,
        Player1wins: Player1wins,
        Player2wins: Player2wins, 
        scoreOne: scoreOne,
        scoreTwo: scoreTwo,
        roundScore:roundScore,
        chances: chances,
        player1: player1,
        player2: player2,
        dateAdded: firebase.database.ServerValue.TIMESTAMP
      });
      


    

    // // Firebase watcher + initial loader + order/limit HINT: .on("child_added"
    database.ref().orderByChild("dateAdded").limitToLast(15).on("child_added", function(snapshot) {
    //   // storing the snapshot.val() in a variable for convenience
     var dbquery = snapshot.val();

     
      $("#chances").text("Rounds " + snapshot.child('chances').val());
      $("#chances2").text("Rounds " + snapshot.child('chances').val());
      $("#score1").text("Score " + snapshot.child('scoreOne').val());
      $("#score2").text("Score " + snapshot.child('scoreTwo').val());
    

     }); 

 function reset(){
  $("#try").on("click", function(){
    console.log("click");
  $("#main1", "#main2").empty();

   });
}
   reset();

   });
  </script>
    </body>
    </html>
    
    
